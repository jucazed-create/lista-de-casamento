<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lista de Casamento | Ismael e Isadora</title>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBAsRYLwsbpnIWHzIn9MgRJ_KEbfozMzBM",
      authDomain: "lista-casamento-ismael-isadora.firebaseapp.com",
      projectId: "lista-casamento-ismael-isadora",
      storageBucket: "lista-casamento-ismael-isadora.appspot.com",
      messagingSenderId: "144463156414",
      appId: "1:144463156414:web:4f0e03c3153f61d36dbaef"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const lista = document.getElementById('lista');
    const form = document.getElementById('adminForm');

    const urlParams = new URLSearchParams(window.location.search);
    const isAdmin = urlParams.get('admin') === '1';

    if (isAdmin) document.getElementById('adminArea').style.display = 'block';

    onSnapshot(collection(db, 'itens'), (snapshot) => {
      lista.innerHTML = '';
      snapshot.forEach((docSnap) => {
        const item = docSnap.data();
        const id = docSnap.id;

        lista.innerHTML += `
          <div class="card ${item.doado ? 'doado' : ''}">
            <img src="${item.imagem}" />
            <h3>${item.nome}</h3>
            <p>R$ ${item.valor}</p>
            ${item.doado ? '<span class="selo">DOADO</span>' : `<button onclick="presentear('${id}')">Presentear</button>`}
            ${isAdmin ? `<button onclick="excluir('${id}')" class="excluir">Excluir</button>` : ''}
          </div>
        `;
      });
    });

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'itens'), {
        nome: nome.value,
        valor: valor.value,
        imagem: imagem.value,
        doado: false
      });
      form.reset();
    });

    window.presentear = async (id) => {
      await updateDoc(doc(db, 'itens', id), { doado: true });
      window.location.href = 'https://wa.me/5599999999999?text=Presenteei um item da lista ðŸ’•';
    }

    window.excluir = async (id) => {
      if (confirm('Excluir item?')) await deleteDoc(doc(db, 'itens', id));
    }
  </script>

  <style>
    body { font-family: Arial; background:#fafafa; text-align:center; }
    h1 { color:#c06; }
    .frase { margin-bottom:20px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; padding:20px; }
    .card { background:white; padding:15px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.1); }
    img { width:100%; height:180px; object-fit:cover; border-radius:10px; }
    button { background:#c06; color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; }
    .excluir { background:#999; margin-top:10px; }
    .doado { opacity:0.6; }
    .selo { display:block; color:green; font-weight:bold; margin-top:10px; }
    #adminArea { display:none; background:#fff; padding:20px; margin:20px; border-radius:12px; }
  </style>
</head>
<body>

<h1>Ismael e Isadora</h1>
<p class="frase">Com amor Deus nos uniu, com amor criamos nosso lar ðŸ’•</p>

<div id="adminArea">
  <h2>Adicionar Item</h2>
  <form id="adminForm">
    <input id="nome" placeholder="Nome do item" required /><br><br>
    <input id="valor" placeholder="Valor" required /><br><br>
    <input id="imagem" placeholder="URL da imagem" required /><br><br>
    <button type="submit">Adicionar</button>
  </form>
</div>

<div id="lista" class="grid"></div>

</body>
</html>
